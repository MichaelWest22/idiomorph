var Idiomorph=function(){;"use strict";function e(e,t,n={}){e=s(e);const o=f(t);const i=a(e,o,n);if(i.morphStyle==="innerHTML"){c(i,e,o);i.pantry.remove();return Array.from(e.childNodes)}else if(i.morphStyle=="attributes"){if(o.firstChild)l(e,o.firstChild,i);i.pantry.remove();return[e]}else{return r(i,e,o)}}function r(e,t,n){const o=t.parentNode;const i=t.previousSibling;const r=t.nextSibling;c(e,o,n,t,r);const l=[];let a=i?.nextSibling||o.firstChild;while(a&&a!=r){l.push(a);a=a.nextSibling}e.pantry.remove();return l}const c=function(){function e(e,t,n,o=null,i=null){if(t instanceof HTMLTemplateElement&&n instanceof HTMLTemplateElement){t=t.content;n=n.content}o||=t.firstChild;for(const r of n.childNodes){if(o&&o!=i){const a=u(e,r,o,i);if(a){if(a!==o){m(e,o,a)}b(a,r,e);o=a.nextSibling;continue}}if(r instanceof Element&&e.persistentIds.has(r.id)){const c=p(t,r.id,o,e);b(c,r,e);o=c.nextSibling;continue}const l=f(t,r,o,e);if(l){o=l.nextSibling}}while(o&&o!=i){const s=o;o=o.nextSibling;d(e,s)}}function f(e,t,n,o){if(o.callbacks.beforeNodeAdded(t)===false)return null;if(o.idMap.has(t)){const i=document.createElement(t.tagName);e.insertBefore(i,n);b(i,t,o);o.callbacks.afterNodeAdded(i);return i}else{const r=document.importNode(t,true);e.insertBefore(r,n);o.callbacks.afterNodeAdded(r);return r}}const u=function(){function e(e,t,n,o){let i=null;let r=t.nextSibling;let l=0;let a=0;const c=e.idMap.get(t)?.size||0;let s=n;while(s&&s!=o){if(u(s,t)){if(f(e,s,t)){return s}if(i===null){if(!e.idMap.has(s)){if(!c){return s}else{i=s}}}}a+=e.idMap.get(s)?.size||0;if(a>c){break}if(i===null&&r&&u(s,r)){l++;r=r.nextSibling;if(l>=2){i=undefined}}if(s.contains(document.activeElement))break;s=s.nextSibling}return i||null}function f(e,t,n){let o=e.idMap.get(t);let i=e.idMap.get(n);if(!i||!o)return false;for(const r of o){if(i.has(r)){return true}}return false}function u(e,t){const n=e;const o=t;return n.nodeType===o.nodeType&&n.tagName===o.tagName&&(!n.id||n.id===o.id)}return e}();function d(e,t){if(e.idMap.has(t)){l(e.pantry,t,null)}else{if(e.callbacks.beforeNodeRemoved(t)===false)return;t.parentNode?.removeChild(t);e.callbacks.afterNodeRemoved(t)}}function m(t,e,n){let o=e;while(o&&o!==n){let e=o;o=o.nextSibling;d(t,e)}return o}function p(e,t,n,o){const i=o.target.id===t&&o.target||o.target.querySelector(`[id="${t}"]`)||o.pantry.querySelector(`[id="${t}"]`);r(i,o);l(e,i,n);return i}function r(t,n){const o=t.id;while(t=t.parentNode){let e=n.idMap.get(t);if(e){e.delete(o);if(!e.size){n.idMap.delete(t)}}}}function l(t,n,o){if(t.moveBefore){try{t.moveBefore(n,o)}catch(e){t.insertBefore(n,o)}}else{t.insertBefore(n,o)}}return e}();const{morphNode:b,morphAttributes:l}=function(){function e(e,t,n){if(n.ignoreActive&&e===document.activeElement){return null}if(n.callbacks.beforeNodeMorphed(e,t)===false){return e}o(e,t,n);if(n.syncInputValue||e.innerHTML!==t.innerHTML){c(n,e,t)}n.callbacks.afterNodeMorphed(e,t);return e}function o(e,t,n){let o=t.nodeType;if(o===1){const i=e;const r=t;const l=i.attributes;const a=r.attributes;for(const c of a){if(u(c.name,i,"update",n)){continue}if(i.getAttribute(c.name)!==c.value){i.setAttribute(c.name,c.value)}}for(let e=l.length-1;0<=e;e--){const s=l[e];if(!s)continue;if(!r.hasAttribute(s.name)){if(u(s.name,i,"remove",n)){continue}i.removeAttribute(s.name)}}if(n.syncInputValue){f(i,r,n)}else if(i instanceof HTMLTextAreaElement&&r instanceof HTMLTextAreaElement&&i.defaultValue!=r.defaultValue){if(!u("value",i,"update",n)){i.value=r.value}}}if(o===8||o===3){if(e.nodeValue!==t.nodeValue){e.nodeValue=t.nodeValue}}}function f(n,o,i){if(n instanceof HTMLInputElement&&o instanceof HTMLInputElement&&o.type!=="file"){let e=o.value;let t=n.value;r(n,o,"checked",i);r(n,o,"disabled",i);if(!o.hasAttribute("value")){if(!u("value",n,"remove",i)){n.value="";n.removeAttribute("value")}}else if(t!==e){if(!u("value",n,"update",i)){n.setAttribute("value",e);n.value=e}}}else if(n instanceof HTMLOptionElement&&o instanceof HTMLOptionElement){r(n,o,"selected",i)}else if(n instanceof HTMLTextAreaElement&&o instanceof HTMLTextAreaElement){let e=o.value;let t=n.value;if(u("value",n,"update",i)){return}if(e!==t){n.value=e}}}function r(e,t,n,o){const i=t[n],r=e[n];if(i!==r){const l=u(n,e,"update",o);if(!l){e[n]=t[n]}if(i){if(!l){e.setAttribute(n,"")}}else{if(!u(n,e,"remove",o)){e.removeAttribute(n)}}}}function u(e,t,n,o){return o.callbacks.beforeAttributeUpdated(e,t,n)===false}return{morphNode:e,morphAttributes:o}}();const{createMorphContext:a,createDefaults:t,addConfig:n,getConfig:o}=function(){function e(e,t,n){const{persistentIds:o,idMap:i}=b(e,t);const r=a(n);const l=r.morphStyle||"outerHTML";if(!["innerHTML","outerHTML","attributes"].includes(l)){throw`Do not understand how to morph style ${l}`}return{target:e,newContent:t,config:r,morphStyle:l,ignoreActive:r.ignoreActive,syncInputValue:r.syncInputValue,idMap:i,persistentIds:o,pantry:m(),callbacks:r.callbacks}}function c(e,t,n,o){const i=document.body.dispatchEvent(new CustomEvent(t,{cancelable:n,detail:{node:e}}));const r=o(e);return i&&r}function s(e,t,n,o,i){const r=document.body.dispatchEvent(new CustomEvent(n,{cancelable:o,detail:{oldNode:e,newNode:t}}));const l=i(e,t);return r&&l}function f(e,t,n,o,i,r){const l=document.body.dispatchEvent(new CustomEvent(o,{cancelable:i,detail:{attributeName:e,node:t,mutationType:n}}));const a=r(e,t,n);return l&&a}const i=()=>{};let u=new Map;function t(){let t={morphStyle:"outerHTML",callbacks:{beforeNodeAdded:i,afterNodeAdded:i,beforeNodeMorphed:i,afterNodeMorphed:i,beforeNodeRemoved:i,afterNodeRemoved:i,beforeAttributeUpdated:i},eventCallbacks:""};const n=document.querySelector('meta[name="idiomorph-config"]');if(n){const e=JSON.parse(n.content);for(const o in e){if(o=="defaults"){t=d(t,e[o])}else{r(o,e[o])}}}return t}function a(e){let t=v;if(typeof e=="string"){for(const n of e.split(",")){const o=u.get(n.trim());if(o){t=d(t,o)}}}else{t=d(t,e)}for(const i of t.eventCallbacks.split(",")){const r=t.callbacks[i];if(r){const l=i.indexOf("before")===0;const a="im-"+i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();if(i.indexOf("Morphed")!==-1){t.callbacks[i]=(e,t)=>{return s(e,t,a,l,r)}}else if(i.indexOf("Updated")!==-1){t.callbacks[i]=(e,t,n)=>{return f(e,t,n,a,l,r)}}else{t.callbacks[i]=e=>{return c(e,a,l,r)}}}}return t}function d(e,t){let n={...e};n={...n,...t};n.callbacks={...e.callbacks,...t.callbacks};return n}function r(e,t){delete u.name;u.set(e,t)}function m(){const e=document.createElement("div");e.hidden=true;document.body.insertAdjacentElement("afterend",e);return e}function l(e){let t=Array.from(e.querySelectorAll("[id]"));if(e.id){t.push(e)}return t}function p(n,e,o,t){for(const i of t){if(e.has(i.id)){let t=i;while(t&&t!==o){let e=n.get(t);if(e==null){e=new Set;n.set(t,e)}e.add(i.id);t=t.parentElement}}}}function b(e,t){const n=l(e);const o=t.querySelectorAll("[id]");const i=h(n,o);let r=new Map;p(r,i,e.parentElement,n);p(r,i,t,o);return{persistentIds:i,idMap:r}}function h(e,t){let n=new Set;let o=new Map;for(const{id:r,tagName:l}of e){if(o.has(r)){n.add(r)}else{o.set(r,l)}}let i=new Set;for(const{id:r,tagName:l}of t){if(i.has(r)){n.add(r)}else if(o.get(r)===l){i.add(r)}}for(const r of n){i.delete(r)}return i}return{createMorphContext:e,createDefaults:t,addConfig:r,getConfig:a}}();const{normalizeElement:s,normalizeParent:f}=function(){const i=new WeakSet;function e(e){if(e instanceof Document){return e.documentElement}else{return e}}function o(e){if(e==null){return document.createElement("div")}else if(typeof e==="string"){return o(r(e))}else if(i.has(e)){return e}else if(e instanceof Node){const t=document.createElement("div");t.append(e);return t}else{const t=document.createElement("div");for(const n of[...e]){t.append(n)}return t}}function r(n){let o=new DOMParser;let e=n.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(e.match(/<\/html>/)||e.match(/<\/head>/)||e.match(/<\/body>/)){let t=o.parseFromString(n,"text/html");if(e.match(/<\/html>/)){i.add(t);return t}else{let e=t.firstChild;if(e){i.add(e)}return e}}else{let e=o.parseFromString("<body><template>"+n+"</template></body>","text/html");let t=e.body.querySelector("template").content;i.add(t);return t}}return{normalizeElement:e,normalizeParent:o}}();const v=t();return{morph:e,defaults:v,addConfig:n,getConfig:o}}();