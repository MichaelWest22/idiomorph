var Idiomorph=function(){;"use strict";function e(e,t,n={}){e=u(e);const o=f(t);const r=a(e,o,n);if(r.morphStyle==="innerHTML"){c(r,e,o);r.pantry.remove();return Array.from(e.childNodes)}else if(r.morphStyle=="attributes"){if(o.firstChild)l(e,o.firstChild,r);r.pantry.remove();return[e]}else{return i(r,e,o)}}function i(e,t,n){const o=t.parentNode;const r=t.previousSibling;const i=t.nextSibling;c(e,o,n,t,i);const l=[];let a=r?.nextSibling||o.firstChild;while(a&&a!=i){l.push(a);a=a.nextSibling}e.pantry.remove();return l}const c=function(){function e(e,t,n,o=null,r=null){if(t instanceof HTMLTemplateElement&&n instanceof HTMLTemplateElement){t=t.content;n=n.content}o||=t.firstChild;for(const i of n.childNodes){if(o&&o!=r){const a=s(e,i,o,r);if(a){if(a!==o){m(e,o,a)}h(a,i,e);o=a.nextSibling;continue}}if(i instanceof Element&&e.persistentIds.has(i.id)){const c=p(t,i.id,o,e);h(c,i,e);o=c.nextSibling;continue}const l=f(t,i,o,e);if(l){o=l.nextSibling}}while(o&&o!=r){const u=o;o=o.nextSibling;d(e,u)}}function f(e,t,n,o){if(o.callbacks.beforeNodeAdded(t)===false)return null;if(o.idMap.has(t)){const r=document.createElement(t.tagName);e.insertBefore(r,n);h(r,t,o);o.callbacks.afterNodeAdded(r);return r}else{const i=document.importNode(t,true);e.insertBefore(i,n);o.callbacks.afterNodeAdded(i);return i}}const s=function(){function e(e,t,n,o){let r=null;let i=t.nextSibling;let l=0;let a=0;const c=e.idMap.get(t)?.size||0;let u=n;while(u&&u!=o){if(s(u,t)){if(f(e,u,t)){return u}if(r===null){if(!e.idMap.has(u)){if(!c){return u}else{r=u}}}}a+=e.idMap.get(u)?.size||0;if(a>c){break}if(r===null&&i&&s(u,i)){l++;i=i.nextSibling;if(l>=2){r=undefined}}if(u.contains(document.activeElement))break;u=u.nextSibling}return r||null}function f(e,t,n){let o=e.idMap.get(t);let r=e.idMap.get(n);if(!r||!o)return false;for(const i of o){if(r.has(i)){return true}}return false}function s(e,t){const n=e;const o=t;return n.nodeType===o.nodeType&&n.tagName===o.tagName&&(!n.id||n.id===o.id)}return e}();function d(e,t){if(e.idMap.has(t)){l(e.pantry,t,null)}else{if(e.callbacks.beforeNodeRemoved(t)===false)return;t.parentNode?.removeChild(t);e.callbacks.afterNodeRemoved(t)}}function m(t,e,n){let o=e;while(o&&o!==n){let e=o;o=o.nextSibling;d(t,e)}return o}function p(e,t,n,o){const r=o.target.id===t&&o.target||o.target.querySelector(`[id="${t}"]`)||o.pantry.querySelector(`[id="${t}"]`);i(r,o);l(e,r,n);return r}function i(t,n){const o=t.id;while(t=t.parentNode){let e=n.idMap.get(t);if(e){e.delete(o);if(!e.size){n.idMap.delete(t)}}}}function l(t,n,o){if(t.moveBefore){try{t.moveBefore(n,o)}catch(e){t.insertBefore(n,o)}}else{t.insertBefore(n,o)}}return e}();const{morphNode:h,morphAttributes:l}=function(){function e(e,t,n){if(n.ignoreActive&&e===document.activeElement){return null}if(n.callbacks.beforeNodeMorphed(e,t)===false){return e}o(e,t,n);if(n.syncInputValue||e.innerHTML!==t.innerHTML){c(n,e,t)}n.callbacks.afterNodeMorphed(e,t);return e}function o(e,t,n){let o=t.nodeType;if(o===1){const r=e;const i=t;const l=r.attributes;const a=i.attributes;for(const c of a){if(s(c.name,r,"update",n)){continue}if(r.getAttribute(c.name)!==c.value){r.setAttribute(c.name,c.value)}}for(let e=l.length-1;0<=e;e--){const u=l[e];if(!u)continue;if(!i.hasAttribute(u.name)){if(s(u.name,r,"remove",n)){continue}r.removeAttribute(u.name)}}if(n.syncInputValue){f(r,i,n)}else if(r instanceof HTMLTextAreaElement&&i instanceof HTMLTextAreaElement&&r.defaultValue!=i.defaultValue){if(!s("value",r,"update",n)){r.value=i.value}}}if(o===8||o===3){if(e.nodeValue!==t.nodeValue){e.nodeValue=t.nodeValue}}}function f(n,o,r){if(n instanceof HTMLInputElement&&o instanceof HTMLInputElement&&o.type!=="file"){let e=o.value;let t=n.value;i(n,o,"checked",r);i(n,o,"disabled",r);if(!o.hasAttribute("value")){if(!s("value",n,"remove",r)){n.value="";n.removeAttribute("value")}}else if(t!==e){if(!s("value",n,"update",r)){n.setAttribute("value",e);n.value=e}}}else if(n instanceof HTMLOptionElement&&o instanceof HTMLOptionElement){i(n,o,"selected",r)}else if(n instanceof HTMLTextAreaElement&&o instanceof HTMLTextAreaElement){let e=o.value;let t=n.value;if(s("value",n,"update",r)){return}if(e!==t){n.value=e}}}function i(e,t,n,o){const r=t[n],i=e[n];if(r!==i){const l=s(n,e,"update",o);if(!l){e[n]=t[n]}if(r){if(!l){e.setAttribute(n,"")}}else{if(!s(n,e,"remove",o)){e.removeAttribute(n)}}}}function s(e,t,n,o){return o.callbacks.beforeAttributeUpdated(e,t,n)===false}return{morphNode:e,morphAttributes:o}}();const{createMorphContext:a,createDefaults:t,addConfig:n,getConfig:o}=function(){function e(e,t,n){const{persistentIds:o,idMap:r}=h(e,t);const i=a(n);const l=i.morphStyle||"outerHTML";if(!["innerHTML","outerHTML","attributes"].includes(l)){throw`Do not understand how to morph style ${l}`}return{target:e,newContent:t,config:i,morphStyle:l,ignoreActive:i.ignoreActive,syncInputValue:i.syncInputValue,idMap:r,persistentIds:o,pantry:m(),callbacks:i.callbacks}}function c(e,t,n,o){const r=document.body.dispatchEvent(new CustomEvent(t,{cancelable:n,detail:{node:e}}));const i=o(e);return r&&i}function u(e,t,n,o,r){const i=document.body.dispatchEvent(new CustomEvent(n,{cancelable:o,detail:{oldNode:e,newNode:t}}));const l=r(e,t);return i&&l}function f(e,t,n,o,r,i){const l=document.body.dispatchEvent(new CustomEvent(o,{cancelable:r,detail:{attributeName:e,node:t,mutationType:n}}));const a=i(e,t,n);return l&&a}const r=()=>{};let s=new Map;function t(){let t={morphStyle:"outerHTML",callbacks:{beforeNodeAdded:r,afterNodeAdded:r,beforeNodeMorphed:r,afterNodeMorphed:r,beforeNodeRemoved:r,afterNodeRemoved:r,beforeAttributeUpdated:r},eventCallbacks:""};const n=document.querySelector('meta[name="idiomorph-config"]');if(n){const e=JSON.parse(n.content);for(const o in e){if(o=="defaults"){t=d(t,e[o])}else{i(o,e[o])}}}return t}function a(e){let t=g;if(typeof e=="string"){for(const n of e.split(",")){const o=s.get(n.trim());if(o){t=d(t,o)}}}else{t=d(t,e)}for(const r of t.eventCallbacks.split(",")){const i=t.callbacks[r];if(i){const l=r.indexOf("before")===0;const a="im-"+r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();if(r.indexOf("Morphed")!==-1){t.callbacks[r]=(e,t)=>{return u(e,t,a,l,i)}}else if(r.indexOf("Updated")!==-1){t.callbacks[r]=(e,t,n)=>{return f(e,t,n,a,l,i)}}else{t.callbacks[r]=e=>{return c(e,a,l,i)}}}}return t}function d(e,t){let n={...e};n={...n,...t};n.callbacks={...e.callbacks,...t.callbacks};return n}function i(e,t){delete s.name;s.set(e,t)}function m(){const e=document.createElement("div");e.hidden=true;document.body.insertAdjacentElement("afterend",e);return e}function l(e){let t=Array.from(e.querySelectorAll("[id]"));if(e.id){t.push(e)}return t}function p(n,e,o,t){for(const r of t){if(e.has(r.id)){let t=r;while(t&&t!==o){let e=n.get(t);if(e==null){e=new Set;n.set(t,e)}e.add(r.id);t=t.parentElement}}}}function h(e,t){const n=l(e);const o=t.querySelectorAll("[id]");const r=b(n,o);let i=new Map;p(i,r,e.parentElement,n);p(i,r,t,o);return{persistentIds:r,idMap:i}}function b(e,t){let n=new Set;let o=new Map;for(const{id:i,tagName:l}of e){if(o.has(i)){n.add(i)}else{o.set(i,l)}}let r=new Set;for(const{id:i,tagName:l}of t){if(r.has(i)){n.add(i)}else if(o.get(i)===l){r.add(i)}}for(const i of n){r.delete(i)}return r}return{createMorphContext:e,createDefaults:t,addConfig:i,getConfig:a}}();const{normalizeElement:u,normalizeParent:f}=function(){const r=new WeakSet;function e(e){if(e instanceof Document){return e.documentElement}else{return e}}function o(e){if(e==null){return document.createElement("div")}else if(typeof e==="string"){return o(i(e))}else if(r.has(e)){return e}else if(e instanceof Node){const t=document.createElement("div");t.append(e);return t}else{const t=document.createElement("div");for(const n of[...e]){t.append(n)}return t}}function i(n){let o=new DOMParser;let e=n.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(e.match(/<\/html>/)||e.match(/<\/head>/)||e.match(/<\/body>/)){let t=o.parseFromString(n,"text/html");if(e.match(/<\/html>/)){r.add(t);return t}else{let e=t.firstChild;if(e){r.add(e)}return e}}else{let e=o.parseFromString("<body><template>"+n+"</template></body>","text/html");let t=e.body.querySelector("template").content;r.add(t);return t}}return{normalizeElement:e,normalizeParent:o}}();const g=t();return{morph:e,defaults:g,addConfig:n,getConfig:o}}();(function(){function r(e){if(e.startsWith("morph")){e=e.replaceAll(";",":").slice(5);if(e===""){return{morphStyle:"outerHTML"}}else if(e.startsWith(":")){return e.slice(1)}}else if(htmx.config.morphByDefault!==false&&e=="innerHTML"){return{morphStyle:"innerHTML"}}}let n;htmx.defineExtension("morph",{init:function(e){n=e},isInlineSwap:function(e){let t=r(e);t=Idiomorph.getConfig(t);return t?.morphStyle!=="innerHTML"},handleSwap:function(e,t,n){let o=r(e);if(o){return Idiomorph.morph(t,n.children,o)}},transformResponse:function(e,t,n){if(htmx.config.morphByDefault===false)return e;return e.replace(/hx-swap-oob="(true|outerHTML)/gi,'hx-swap-oob="morph').replace(/hx-swap-oob='(true|outerHTML)/gi,"hx-swap-oob='morph")},onEvent:function(e,t){if(htmx.config.morphByDefault!==false&&e==="htmx:beforeSwap"){if(htmx.config.defaultSwapStyle==="outerHTML")htmx.config.defaultSwapStyle="morph";let e=t.detail.swapOverride||n.getClosestAttributeValue(t.detail.elt,"hx-swap");if(e&&e.startsWith("outerHTML")){t.detail.swapOverride=e.replace(/outerHTML/,"morph")}}}});Idiomorph.addConfig("outerHTML",{morphStyle:"outerHTML"});Idiomorph.addConfig("innerHTML",{morphStyle:"innerHTML"});Idiomorph.addConfig("ignoreActive",{ignoreActive:true});Idiomorph.addConfig("syncInputValue",{syncInputValue:true});Idiomorph.addConfig("attributes",{morphStyle:"attributes"});Idiomorph.addConfig("removeAttributes",{morphStyle:"attributes",callbacks:{beforeAttributeUpdated:(e,t,n)=>{if(n==="update")return false}}});Idiomorph.addConfig("addAttributes",{morphStyle:"attributes",callbacks:{beforeAttributeUpdated:(e,t,n)=>{if(n==="remove")return false}}})})();